var __apps=[{id:"ck",name:"Citizen Kin",type:"service",icon:image_root+"noicon.png",public_service:true,description:"Lorem ipsum dolor sit amet",provider:"OpenWide",paid:false,installed:true,target_citizens:true,target_publicbodies:false,target_companies:false},{id:"dl",name:"Ditizen Lin",type:"application",icon:image_root+"noicon.png",public_service:false,description:"Lorem ipsum dolor sit amet",provider:"OpenWide",paid:true,installed:true,target_citizens:false,target_publicbodies:true,target_companies:true},{id:"em",name:"Eitizen Min",type:"service",icon:image_root+"noicon.png",public_service:true,description:"Lorem ipsum dolor sit amet",provider:"OpenWide",paid:true,installed:false,target_citizens:true,target_publicbodies:false,target_companies:false},{id:"fn",name:"Fitizen Nin",type:"service",icon:image_root+"noicon.png",public_service:false,description:"Lorem ipsum dolor sit amet",provider:"OpenWide",paid:false,installed:false,target_citizens:false,target_publicbodies:true,target_companies:false}];var AppStore=React.createClass({displayName:"AppStore",componentDidMount:function(){this.updateApps(true,true,true,true,true)},getInitialState:function(){return{apps:[]}},updateApps:function(target_citizens,target_publicbodies,target_companies,paid,free){$.ajax({url:store_service+"/applications",data:{target_citizens:target_citizens,target_publicbodies:target_publicbodies,target_companies:target_companies,free:free,paid:paid},type:"get",dataType:"json",success:function(data){this.setState({apps:data})}.bind(this),error:function(xhr,status,err){console.error(status,err.toString())}.bind(this)})},render:function(){if(this.state.apps.length==0){return React.DOM.div({className:"row text-center"},React.DOM.i({className:"fa fa-spinner fa-spin"})," ",t("ui.loading"))}else{return React.DOM.div({className:"row"},SideBar({updateApps:this.updateApps}),AppList({apps:this.state.apps}))}}});var SideBar=React.createClass({displayName:"SideBar",getInitialState:function(){return{audience:{citizens:true,publicbodies:true,companies:true},payment:{paid:true,free:true}}},change:function(category,item){return function(){var canChange=false;for(var i in this.state[category]){if(i!=item){if(this.state[category][i]==true){canChange=true;break}}}if(!canChange)return;var state=this.state;state[category][item]=!state[category][item];this.setState(state);this.props.updateApps(state.audience.citizens,state.audience.publicbodies,state.audience.companies,state.payment.paid,state.payment.free)}.bind(this)},render:function(){return React.DOM.div({className:"col-md-4"},React.DOM.h2(null,React.DOM.img({src:image_root+"my/app-store.png"})," ",t("ui.appstore")),React.DOM.div({className:"checkbox"},React.DOM.label(null,React.DOM.input({type:"checkbox",checked:this.state.audience.citizens,onChange:this.change("audience","citizens")}),t("citizens"))),React.DOM.div({className:"checkbox"},React.DOM.label(null,React.DOM.input({type:"checkbox",checked:this.state.audience.publicbodies,onChange:this.change("audience","publicbodies")}),t("publicbodies"))),React.DOM.div({className:"checkbox"},React.DOM.label(null,React.DOM.input({type:"checkbox",checked:this.state.audience.companies,onChange:this.change("audience","companies")}),t("companies"))),React.DOM.div(null),React.DOM.div({className:"checkbox"},React.DOM.label(null,React.DOM.input({type:"checkbox",checked:this.state.payment.free,onChange:this.change("payment","free")}),t("free"))),React.DOM.div({className:"checkbox"},React.DOM.label(null,React.DOM.input({type:"checkbox",checked:this.state.payment.paid,onChange:this.change("payment","paid")}),t("paid"))))}});var AppList=React.createClass({displayName:"AppList",render:function(){var apps=this.props.apps.map(function(app){return App({key:app.id,app:app})});return React.DOM.div({className:"col-md-8 app-store-result"},apps)}});var App=React.createClass({displayName:"App",componentDidMount:function(){if(default_app&&default_app.type==this.props.app.type&&default_app.id==this.props.app.id){this.openApp()}},openApp:function(){this.refs.appmodal.open()},render:function(){var indicatorStatus=this.props.app.installed?"installed":this.props.app.paid?"paid":"free";var pubServiceIndicator=this.props.app.public_service?React.DOM.div({className:"public-service-indicator"},React.DOM.div({className:"triangle"}),React.DOM.div({className:"label"},React.DOM.i({className:"triangle fa fa-institution"}))):null;return React.DOM.div(null,AppModal({ref:"appmodal",app:this.props.app}),React.DOM.div({className:"hit text-center",onClick:this.openApp},pubServiceIndicator,React.DOM.img({src:this.props.app.icon}),React.DOM.p({className:"appname"},this.props.app.name),React.DOM.div({className:"caption"},React.DOM.p(null,this.props.app.provider),React.DOM.p({className:"appdescription"},this.props.app.description)),Indicator({status:indicatorStatus})))}});var Indicator=React.createClass({displayName:"Indicator",render:function(){var btns;var status=this.props.status;if(status=="installed"){btns=[React.DOM.button({key:"indicator_button",className:"btn btn-indicator btn-indicator-installed"},t("installed")),React.DOM.button({key:"indicator_icon",className:"btn btn-indicator btn-indicator-installed-icon"},React.DOM.i({className:"fa fa-check"}))]}else if(status=="free"){btns=[React.DOM.button({key:"indication_button",className:"btn btn-indicator btn-indicator-available"},t("free"))]}else{btns=[React.DOM.button({key:"indicator_button",className:"btn btn-indicator btn-indicator-available"},t("paid")),React.DOM.button({key:"indicator_icon",className:"btn btn-indicator btn-indicator-available-icon"},React.DOM.i({className:"fa fa-eur"}))]}return React.DOM.div({className:"btn-group indicator"},btns)}});var AppModal=React.createClass({displayName:"AppModal",getInitialState:function(){return{app:{rating:0,rateable:true,tos:"",policy:"",longdescription:"",screenshots:null},orgs:[],createOrg:false,buying:false,error:false}},componentDidMount:function(){$(this.refs.modal.getDOMNode()).on("hide.bs.modal",function(event){history.pushState({},"store",store_root)})},loadApp:function(){$.ajax({url:store_service+"/details/"+this.props.app.type+"/"+this.props.app.id,type:"get",dataType:"json",success:function(data){var state=this.state;state.app=data;this.setState(state)}.bind(this),error:function(xhr,status,err){console.error(status,err.toString())}.bind(this)})},loadOrgs:function(){$.ajax({url:network_service+"/organizations",type:"get",dataType:"json",success:function(data){var state=this.state;state.orgs=data;this.setState(state)}.bind(this),error:function(xhr,status,err){console.error(status,err.toString())}.bind(this)})},open:function(){this.setState(this.getInitialState());var href=store_root+"/"+this.props.app.type+"/"+this.props.app.id;if(typeof history.pushState=="function"){history.pushState({},"application",href)}this.loadApp();if(logged_in){this.loadOrgs()}this.refs.modal.open()},installApp:function(organization){var state=this.state;state.buying=true;this.setState(state);var request={appId:this.props.app.id,appType:this.props.app.type};if(organization){request.organizationId=organization}$.ajax({url:store_service+"/buy",type:"post",data:JSON.stringify(request),contentType:"application/json",success:function(data){if(data.success){window.location="/my/dashboard"}else{var state=this.state;state.buying=false;state.error=true;this.setState(state)}}.bind(this),error:function(xhr,status,err){console.error(status,err.toString());var state=this.state;state.buying=false;this.setState(state)}.bind(this)})},createNewOrg:function(){console.log("Create new organization");var state=this.state;state.createOrg=true;this.setState(state)},orgCreated:function(org){var state=this.state;state.createOrg=false;if(org){this.installApp(org.id)}this.setState(state)},doCreateOrg:function(){if(this.refs.createOrgForm){this.refs.createOrgForm.saveOrganization()}},cancelCreateOrg:function(){var state=this.state;state.createOrg=false;this.setState(state)},rateApp:function(rate){$.ajax({url:store_service+"/rate/"+this.props.app.type+"/"+this.props.app.id,type:"post",contentType:"application/json",data:JSON.stringify({rate:rate}),success:function(){var state=this.state;state.app.rateable=false;state.app.rating=rate;this.setState(state)}.bind(this),error:function(xhr,status,err){console.error(status,err.toString())}.bind(this)})},renderAppDescription:function(){var carousel=this.state.app.screenshots&&this.state.app.screenshots.length>0?React.DOM.div({className:"row"},Carousel({images:this.state.app.screenshots})):null;var error=this.state.error?React.DOM.div({className:"alert alert-danger alert-dismissible",role:"alert"},React.DOM.button({type:"button",className:"close","data-dismiss":"alert"},React.DOM.span({"aria-hidden":"true"},"Ã—"),React.DOM.span({className:"sr-only"},t("ui.close"))),React.DOM.strong(null,t("sorry"))," ",t("could-not-install-app")):null;var rateInfo;if(logged_in){rateInfo=this.state.app.rateable?null:React.DOM.p(null,t("already-rated"))}else{rateInfo=null}return React.DOM.div(null,React.DOM.div({className:"row"},React.DOM.div({className:"col-sm-1"},React.DOM.img({src:this.props.app.icon,alt:this.props.app.name})),React.DOM.div({className:"col-sm-7"},React.DOM.div(null,React.DOM.p({className:"appname"},this.props.app.name),React.DOM.p(null,t("by")," ",this.props.app.provider))),React.DOM.div({className:"col-sm-4 center-container install-application"},InstallButton({app:this.props.app,orgs:this.state.orgs,installApp:this.installApp,createNewOrg:this.createNewOrg}))),React.DOM.div({className:"row"},Rating({rating:this.state.app.rating,rateable:this.state.app.rateable,rate:this.rateApp}),rateInfo),error,carousel,React.DOM.div({className:"row"},React.DOM.div({className:"col-md-6",dangerouslySetInnerHTML:{__html:this.state.app.longdescription}}),React.DOM.div({className:"col-md-6"},React.DOM.p(null,t("agree-to-tos")),React.DOM.p(null,React.DOM.a({href:this.state.app.tos},t("tos"))),React.DOM.p(null,React.DOM.a({href:this.state.app.policy},t("privacy"))))))},renderCreateNew:function(){return React.DOM.div(null,React.DOM.h3(null,t("create-new-org")),CreateOrganizationForm({ref:"createOrgForm",successHandler:this.orgCreated}),React.DOM.div({className:"row"},React.DOM.div({className:"col-sm-4 col-sm-offset-8"},React.DOM.a({className:"btn btn-default",onClick:this.cancelCreateOrg},t("ui.cancel")),React.DOM.a({className:"btn btn-primary",onClick:this.doCreateOrg},t("create")))))},renderBuying:function(){return React.DOM.h3(null,React.DOM.i({className:"fa fa-spinner fa-spin"})," ",t("buying"))},render:function(){var content=null;if(this.state.buying){content=this.renderBuying()}else if(this.state.createOrg){content=this.renderCreateNew()}else{content=this.renderAppDescription()}return Modal({ref:"modal",large:true,infobox:true,title:this.props.app.name},content)}});var InstallButton=React.createClass({displayName:"InstallButton",onlyForCitizens:function(){return this.props.app.target_citizens&&!this.props.app.target_companies&&!this.props.app.target_publicbodies},hasCitizens:function(){return this.props.app.target_citizens},componentDidMount:function(){if(!this.onlyForCitizens()){$("#install").popover({content:$("#install-app-popover").html(),html:true,placement:"bottom",trigger:"click"});$(this.getDOMNode()).find("button[data-toggle='dropdown']").dropdown()}},installApp:function(event){event.preventDefault();this.props.installApp()},installAppForOrganization:function(orgId){return function(event){event.preventDefault();this.props.installApp(orgId)}.bind(this)},render:function(){if(logged_in){if(this.onlyForCitizens()){return React.DOM.a({className:"btn btn-primary",href:"#",onClick:this.installApp},t("install"))}else{var organizations=this.props.orgs.map(function(org){return React.DOM.li({key:org.id},React.DOM.a({href:"#",onClick:this.installAppForOrganization(org.id)},org.name))}.bind(this));return MyPop({className:"btn btn-primary",label:t("install")},React.DOM.div({className:"row"},React.DOM.div({className:"col-sm-2"},React.DOM.img({src:image_root+"my/app-store.png"})),React.DOM.div({className:"col-sm-10"},React.DOM.h4(null,t("install_this_app")),React.DOM.p(null,t("confirm-install-this-app")),this.props.app.paid?React.DOM.p(null,t("confirm-install-this-app-paid")):null,React.DOM.button({type:"button",className:"btn btn-default",onClick:this.installApp},t("for_myself")),React.DOM.button({type:"button",className:"btn btn-default","data-toggle":"dropdown"},t("on_behalf_of"),React.DOM.span({className:"caret"})),React.DOM.ul({className:"dropdown-menu",role:"menu"},organizations,React.DOM.li(null,React.DOM.a({href:"#",onClick:this.props.createNewOrg},t("create-new-org")))))))}}else{return React.DOM.a({className:"btn btn-primary-inverse",href:store_root+"/login?appId="+this.props.app.id+"&appType="+this.props.app.type},t("install"))}}});var Carousel=React.createClass({displayName:"Carousel",getInitialState:function(){return{index:0}},back:function(){var index=this.state.index;index=Math.max(0,index-1);this.setState({index:index})},forward:function(){var index=this.state.index;index=Math.min(this.props.images.length,index+1);this.setState({index:index})},render:function(){if(!this.props.images){return null}var back=null;if(this.state.index>0){back=React.DOM.a({className:"back",onClick:this.back},React.DOM.i({className:"fa fa-chevron-left"}))}var forward=null;if(this.state.index<this.props.images.length-1){forward=React.DOM.a({className:"forward",onClick:this.forward},React.DOM.i({className:"fa fa-chevron-right"}))}return React.DOM.div({className:"carousel"},back,React.DOM.img({src:this.props.images[this.state.index],alt:this.state.index}),forward)}});var Rating=React.createClass({displayName:"Rating",getInitialState:function(){return{}},startEditing:function(){if(this.props.rateable){this.setState({editing:true,rating:0})}},stopEditing:function(){this.setState({editing:false,rating:0})},rate:function(){if(this.props.rateable){this.props.rate(this.state.rating)}},mouseMove:function(event){if(this.state.editing){var rect=this.getDOMNode().getBoundingClientRect();var x=Math.floor(8*(event.clientX-rect.left)/rect.width)/2;if(rect.right-event.clientX<5){x=4}this.setState({editing:true,rating:x})}},render:function(){var className;var rating;if(this.state.editing){rating=this.state.rating}else{rating=this.props.rating}var rt=rating<1?"0"+rating*10:rating*10;className="rating-static rating-"+rt;return React.DOM.div({className:className,onMouseEnter:this.startEditing,onMouseLeave:this.stopEditing,onMouseMove:this.mouseMove,onClick:this.rate})}});React.renderComponent(AppStore(null),document.getElementById("store"));