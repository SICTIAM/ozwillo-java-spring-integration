var MyApps=React.createClass({displayName:"MyApps",getInitialState:function(){return{loading:!0,authorities:[]}},componentDidMount:function(){$.ajax({url:apps_service+"/authorities",dataType:"json",success:function(data){this.setState({loading:!1,authorities:data})}.bind(this),error:function(xhr,status,err){}.bind(this)})},render:function(){if(this.state.loading)return React.DOM.p({className:"text-center"},React.DOM.i({className:"fa fa-spinner fa-spin"})," ",t("ui.loading"));var auths=this.state.authorities.map(function(auth){return Authority({name:auth.name,key:auth.id,openByDefault:"INDIVIDUAL"==auth.type})});return React.DOM.div({className:"container panel-group"},auths)}}),Authority=React.createClass({displayName:"Authority",getInitialState:function(){return{open:this.props.openByDefault}},toggle:function(){this.setState({open:!this.state.open})},render:function(){var content;return content=this.state.open?InstanceList({id:this.props.key,name:this.props.name,authority:this.props.key}):null,React.DOM.div({className:"panel panel-default"},React.DOM.div({className:"panel-heading"},React.DOM.h4({className:"panel-title",onClick:this.toggle},React.DOM.span(null,this.props.name),OpenAuthority({callback:this.toggle,open:this.state.open}))),React.DOM.div({ref:"content"},content))}}),OpenAuthority=React.createClass({displayName:"OpenAuthority",click:function(){this.props.callback()},render:function(){var className=this.props.open?"caret":"caret inverse";return React.DOM.a({className:"authority-link pull-right",onClick:this.click},React.DOM.b({className:className}))}}),InstanceList=React.createClass({displayName:"InstanceList",getInitialState:function(){return{loading:!0,instances:[]}},componentDidMount:function(){this.reloadInstances()},reloadInstances:function(){this.setState(this.getInitialState()),$.ajax({url:apps_service+"/instances/"+this.props.id,dataType:"json",success:function(data){this.setState({loading:!1,instances:data})}.bind(this),error:function(xhr,status,err){}.bind(this)})},componentDidUpdate:function(){$(this.getDOMNode()).toggle("blind")},render:function(){if(this.state.loading)return React.DOM.p({className:"text-center"},React.DOM.i({className:"fa fa-spinner fa-spin"})," ",t("ui.loading"));var instances=this.state.instances,authority=this.props.authority,reload=this.reloadInstances,result=0!=instances.length?instances.map(function(instance){return Instance({key:instance.id,instance:instance,authority:authority,reload:reload})}):React.DOM.div({className:"text-center"},React.DOM.span(null,t("none")," "),React.DOM.b(null,this.props.name));return React.DOM.div({className:"panel collapse"},result)}}),Instance=React.createClass({displayName:"Instance",manageUsers:function(event){event.preventDefault(),this.refs.users.init(),this.refs.manageUsers.open()},saveUsers:function(){this.refs.manageUsers.close(),$.ajax({url:apps_service+"/users/instance/"+this.props.key,dataType:"json",contentType:"application/json",type:"post",data:JSON.stringify(this.refs.users.getSelectedUsers()),error:function(xhr,status,err){}.bind(this)})},loadUsers:function(callback,error){$.ajax({url:apps_service+"/users/instance/"+this.props.key,dataType:"json",method:"get",success:callback,error:function(xhr,status,err){void 0!=error&&error()}.bind(this)})},queryUsers:function(query,callback){$.ajax({url:apps_service+"/users/network/"+this.props.authority+"?q="+query,dataType:"json",method:"get",success:callback,error:function(xhr,status,err){}.bind(this)})},componentDidMount:function(){$("a.tip",this.getDOMNode()).tooltip()},deprovision:function(){$.ajax({url:apps_service+"/deprovision/"+this.props.key,type:"post",success:function(){this.props.reload()}.bind(this),error:function(xhr,status,err){}.bind(this)})},render:function(){var instance=this.props.key,services=this.props.instance.services.map(function(service){return Service({key:service.service.id,service:service,instance:instance})}),deprovision=null;return devmode&&(deprovision=React.DOM.a({className:"btn btn-danger pull-right",href:"#",onClick:this.deprovision},t("ui.delete"))),React.DOM.div({className:"panel panel-instance"},Modal({ref:"manageUsers",title:t("manage_users"),successHandler:this.saveUsers},UserPicker({ref:"users",users:this.loadUsers,source:this.queryUsers})),React.DOM.div({className:"panel-heading"},React.DOM.img({height:"32",width:"32",alt:this.props.instance.name,src:this.props.instance.icon}),React.DOM.span({className:"appname"},this.props.instance.name),React.DOM.a({className:"tip btn btn-default pull-right",href:"#",onClick:this.manageUsers,"data-toggle":"tooltip","data-placement":"bottom",title:t("manage_users")},React.DOM.li({className:"fa fa-user"})),deprovision),React.DOM.div({className:"panel-body"},React.DOM.div({className:"standard-form"},React.DOM.div({className:"row form-table-header"},React.DOM.div({"class":"col-sm-10"},t("services"))),services)))}});React.renderComponent(MyApps(null),document.getElementById("myapps"));