var SearchOrganization=React.createClass({displayName:"SearchOrganization",componentDidMount:function(){$(this.refs.modal.getDOMNode()).on("shown.bs.modal",function(){$("input",this).first().focus()})},show:function(){this.refs.modal.open()},close:function(){this.refs.modal.close(),this.props.successHandler&&this.props.successHandler()},openCreateOrModify:function(organization){organization?(this.close(),this.refs.createOrgDialog.show(organization)):this.refs.modalError.open()},searchOrg:function(){this.refs.form.searchOrganization()},render:function(){var buttonLabels={cancel:t("ui.cancel"),save:t("ui.search")};return React.createElement("div",null,React.createElement(Modal,{ref:"modal",title:t("my.network.find-or-create-organization"),successHandler:this.searchOrg,buttonLabels:buttonLabels},React.createElement(SearchOrganizationForm,{ref:"form",successHandler:this.openCreateOrModify})),React.createElement(CreateOrModifyOrganizationModal,{ref:"createOrgDialog",successHandler:this.close}),React.createElement(Modal,{ref:"modalError",title:t("ui.something_went_wrong_title"),infobox:!0,cancelHandler:null},React.createElement("div",null,React.createElement("h5",null,t("search.organization.cannot-be-used")))))}}),SearchOrganizationForm=React.createClass({displayName:"SearchOrganizationForm",getInitialState:function(){this.getProfileInfo();var sector_type="COMPANY",tax_reg_num="",legal_name="";return{orgSearchData:{contact_name:"",contact_lastname:"",contact_email:"",sector_type:sector_type,country:"",country_uri:"",legal_name:legal_name,tax_reg_num:tax_reg_num},errors:[],searching:!1}},getProfileInfo:function(){$.ajax({url:network_service+"/general-user-info",type:"get",contentType:"json",success:function(data){var state=this.state;state.orgSearchData.contact_name=data.user_name,state.orgSearchData.contact_lastname=data.user_lastname,state.orgSearchData.contact_email=data.user_email,state.orgSearchData.country=data.address.country,this.setState(state)}.bind(this),error:function(xhr,status,err){}.bind(this)})},searchOrganization:function(event){if(event&&event.preventDefault(),!this.state.searching){var org=this.state.orgSearchData,errors=[];org.contact_name&&""!=org.contact_name.trim()||errors.push("name"),org.contact_lastname&&""!=org.contact_lastname.trim()||errors.push("lastname"),org.contact_email&&""!=org.contact_email.trim()||errors.push("email"),org.country_uri&&""!=org.country_uri.trim()||errors.push("country"),org.legal_name&&""!=org.legal_name.trim()||errors.push("legal_name"),org.tax_reg_num&&""!=org.tax_reg_num.trim()||errors.push("tax_reg_num"),org.sector_type&&""!=org.sector_type.trim()||errors.push("sector_type"),0==errors.length?(this.state.searching=!0,$.ajax({url:network_service+"/search-organization",type:"get",contentType:"json",data:this.state.orgSearchData,success:function(data){if(this.props.successHandler){var organization=data,state={searching:!1,errors:[]};this.setState(state),this.props.successHandler(organization)}}.bind(this),error:function(xhr,status,err){var state=this.state;state.errors=["general"],state.searching=!1,this.setState(state)}.bind(this)})):(this.state.errors=errors,this.setState(this.state))}},changeInput:function(fieldname){return function(event){var org=this.state.orgSearchData;"country"===fieldname?(org[fieldname+"_uri"]=event.target.value,org[fieldname]=event.target.selectedOptions[0].label):org[fieldname]=event.target.value,this.setState({orgSearchData:org,errors:[],searching:!1})}.bind(this)},toggleType:function(event){var org=this.state.orgSearchData;org.sector_type=event.target.value,this.setState({orgSearchData:org,errors:[],searching:!1})},renderLabel:function(htmlFor,class_name,label){var cn=-1!=$.inArray(class_name,this.state.errors)?"col-sm-3 control-label error":"col-sm-3 control-label";return React.createElement("label",{htmlFor:htmlFor,className:cn},label,React.createElement("label",{className:"error"},"*"))},render:function(){return React.createElement("form",{onSubmit:this.searchOrganization,className:"form-horizontal"},React.createElement("h4",null,t("search.contact.title")),React.createElement(ContactSearchFormControl,{renderLabel:this.renderLabel,orgSearchData:this.state.orgSearchData,changeInput:this.changeInput}),React.createElement("h4",null,t("search.organization.title")),React.createElement(OrganizationSearchFormControl,{errors:this.state.errors,renderLabel:this.renderLabel,orgSearchData:this.state.orgSearchData,changeInput:this.changeInput,toggleType:this.toggleType}))}}),ContactSearchFormControl=React.createClass({displayName:"ContactSearchFormControl",render:function(){return React.createElement("div",{className:"form-group"},React.createElement("div",{className:"form-group"},this.props.renderLabel("contact-name","name",t("search.contact.name")),React.createElement("div",{className:"col-sm-8"},React.createElement("input",{type:"text",className:"form-control",value:this.props.orgSearchData.contact_name,onChange:this.props.changeInput("contact_name"),maxLength:100,placeholder:t("search.contact.name")}))),React.createElement("div",{className:"form-group"},this.props.renderLabel("contact-lastname","lastname",t("search.contact.lastname")),React.createElement("div",{className:"col-sm-8"},React.createElement("input",{type:"text",className:"form-control",value:this.props.orgSearchData.contact_lastname,onChange:this.props.changeInput("contact_lastname"),maxLength:100,placeholder:t("search.contact.lastname")}))),React.createElement("div",{className:"form-group"},this.props.renderLabel("contact-email","email",t("search.contact.email")),React.createElement("div",{className:"col-sm-8"},React.createElement("input",{type:"text",className:"form-control",value:this.props.orgSearchData.contact_email,onChange:this.props.changeInput("contact_email"),maxLength:100,placeholder:t("search.contact.email")}))))}}),OrganizationSearchFormControl=React.createClass({displayName:"OrganizationSearchFormControl",renderType:function(){var restriction=this.props.typeRestriction?this.props.typeRestriction:{company:!0,public_body:!0},public_body=null;restriction.public_body&&(public_body=React.createElement("label",{className:"radio-inline col-sm-3"},React.createElement("input",{type:"radio",value:"PUBLIC_BODY",checked:"PUBLIC_BODY"==this.props.orgSearchData.sector_type,onChange:this.props.toggleType},t("search.organization.sector-type.PUBLIC_BODY"))));var company=null;restriction.company&&(company=React.createElement("label",{className:"radio-inline col-sm-3"},React.createElement("input",{type:"radio",value:"COMPANY",checked:"COMPANY"==this.props.orgSearchData.sector_type,onChange:this.props.toggleType},t("search.organization.sector-type.COMPANY"))));var sectorTypeClassName="col-sm-3 control-label";return sectorTypeClassName=-1!=$.inArray("sector_type",this.props.errors)?sectorTypeClassName+" error":sectorTypeClassName,React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"organization-sector-type",className:sectorTypeClassName},t("search.organization.sector-type")),public_body,company)},render:function(){var label_regNum;switch(this.props.orgSearchData.country){case"България":label_regNum=t("search.organization.business-id.bg");break;case"Italia":label_regNum=t("search.organization.business-id.it");break;case"France":label_regNum=t("search.organization.business-id.fr");break;case"España":label_regNum=t("search.organization.business-id.es");break;case"Türkiye":label_regNum=t("search.organization.business-id.tr");break;default:label_regNum=t("search.organization.business-id.en")}return this.props.orgSearchData.country_uri&&""!==this.props.orgSearchData.country_uri||!this.refs.orgCountrySelect||(this.props.orgSearchData.country_uri=this.refs.orgCountrySelect.getValue(this.props.orgSearchData.country)),React.createElement("div",{className:"form-group"},this.renderType(),React.createElement("div",{className:"form-group"},this.props.renderLabel("organization-country-name","country",t("search.organization.country")),React.createElement("div",{className:"col-sm-5"},React.createElement(CountrySelect,{ref:"orgCountrySelect",className:"form-control",url:store_service+"/dc-countries",defLabel:this.props.orgSearchData.country,onChange:this.props.changeInput("country")}))),React.createElement("div",{className:"form-group"},this.props.renderLabel("organization-name","legal_name",t("search.organization.legal-name")),React.createElement("div",{className:"col-sm-8"},React.createElement("input",{type:"text",className:"form-control",value:this.props.orgSearchData.legal_name,onChange:this.props.changeInput("legal_name"),maxLength:100,placeholder:t("search.organization.legal-name")}))),React.createElement("div",{className:"form-group"},this.props.renderLabel("organization-business-id","tax_reg_num",label_regNum),React.createElement("div",{className:"col-sm-8"},React.createElement("input",{type:"text",className:"form-control",value:this.props.orgSearchData.tax_reg_num,onChange:this.props.changeInput("tax_reg_num"),maxLength:20,placeholder:t(label_regNum)}))))}}),CountrySelect=React.createClass({displayName:"CountrySelect",propTypes:{url:React.PropTypes.string.isRequired},getInitialState:function(){return{options:[],countries:[]}},onChange:function(event){this.props.onChange(event)},componentDidMount:function(){this.props.url&&$.ajax({url:this.props.url,type:"get",dataType:"json",data:{q:" "},success:function(data){var areas=data.areas,options=[{value:"",label:""}];areas=areas.filter(function(n){return null!==n});for(var i=0;i<areas.length;i++)options.push({value:areas[i].uri,label:areas[i].name});this.state.countries=options,this.successHandler(options)}.bind(this),error:function(xhr,status,err){}.bind(this)})},successHandler:function(data){for(var i=0;i<data.length;i++){var option=data[i];this.state.options.push(React.createElement("option",{className:"action-select-option",key:i,value:option.value},option.label))}this.forceUpdate()},getValue:function(label){if(!label||""!==label)for(var i=0;i<this.state.countries.length;i++)if(this.state.countries[i].label===label)return this.state.countries[i].value;return null},render:function(){var label=this.props.defLabel;return this.props.value&&""!==this.props.value||(this.props.value=this.getValue(label)),React.createElement("select",{className:"btn btn-default dropdown-toggle",onChange:this.onChange,value:this.props.value,disabled:this.props.disabled},this.state.options)}});
