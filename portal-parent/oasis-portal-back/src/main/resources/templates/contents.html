<div class="row">
    <div class="col-sm-2 text-center dash-switcher">
        <ul id="dashboard_list" class="nav nav-pills nav-stacked text-left">
            <li th:each="contentId : ${contentIdList}" th:class="${contentId == currentContentId ? 'active' : ''}">
                <a class="dash-switch-link" th:href="${'/contents/edit/' + contentId}" th:text="${contentId}"></a>
            </li>
        </ul>
        <form role="form" id="create-dash" method="POST" action="#" th:action="@{/contents/create}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="form-group">
                <label for="dashboardname" th:text="#{action.create}">+ create new</label>
                <input type="text" name="contentId" id="contentId" class="form-control"/>
            </div>
            <div class="text-right">
                <input type="image" src="../public/img/icon/plus.png" th:src="@{/img/icon/plus.png}" id="create-dashboard-plus" />
            </div>
        </form>
    </div>
    <div class="col-sm-8">
        <div class="form-buttons">
            <input id="currentContentId" type="hidden" th:value="${currentContentId}"/>
            <input id="content" type="hidden" th:value="${content}"/>
            <input id="save" type="button" class="btn btn-primary" th:value="#{action.save}"/>
            <input id="delete" type="button" class="btn btn-default" th:value="#{action.delete}" th:if="${currentContentId != 'home'}" />
            Langue : fran√ßais
        </div>
        <div id="epiceditor"></div>
    </div>
</div>

<!-- XXX Organize code better -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="/js/epiceditor.min.js"></script>
<script type="text/javascript" th:inline="text">
var editor = new EpicEditor({
    basePath: '',
    clientSideStorage: false,
    focusOnLoad: true,
    theme: {
        base: '/css/epiceditor/base/epiceditor.css',
        editor: '/css/epiceditor/editor/epic-light.css',
        preview: '/css/epiceditor/preview/github.css'
    },
    autogrow: {
        minHeight: 300,
        maxHeight: false,
        scroll: true,
    },
    button: {
        bar: "show"
    }
}).load();
editor.importFile('content', $('#content').val());

$('#save').click(function() {
    $this = $(this);
    $this.addClass('btn-disabled');
    
    var currentContentId = $('#currentContentId').val();
    $.ajax({url: "/contents/save",
        type: "POST",
        data: JSON.stringify({
            "id": currentContentId,
            "content": {
                "fr": editor.exportFile()    
            }
        }),
        contentType: "application/json; charset=utf-8",
        dataType: "html",
        success: function (fragment) {
            location.reload();
        }
    });
})

$('#delete').click(function() {
    $this = $(this);
    if (confirm("[[#{action.delete.confirm}]]")) {
        $this.addClass('pending');
        
        var currentContentId = $('#currentContentId').val();
        $.ajax({url: "/contents/delete/" + currentContentId,
            type: "POST",
            dataType: "html",
            success: function (fragment) {
                location.href = "/contents/edit/home";
            }
        });
    }
})
</script>